---
title: "5063 Final Proj"
author: "Yun Yee Tan"
date: "4/5/2021"
output: html_document
---

```{r}
library(tidyverse)
library(ggplot2)
library(plotly)

dssi <- read_csv("dssi_2020.csv")
```

Data source: 
https://databank.worldbank.org/source/international-debt-statistics:-dssi

Georgetown report:
http://gppreview.com/2021/02/10/international-debt-exploring-new-data-world-bank/

"In 2020, the World Bank – reacting to global financial shocks from COVID-19 and emphasizing debt transparency – for the first time released individual creditor countries within “International Debt Statistics.”  The interactive map below visualizes these newly released creditor country breakdowns. Previously, such data was only available at a generalized “creditor region” level. Such a release provides a tremendous level of granularity, which economic and public policy analysts can use to examine relationships between the 120 low and middle-income countries of the world."

World Bank report:
https://openknowledge.worldbank.org/bitstream/handle/10986/34588/9781464816109.pdf


About the DSSI:   
https://www.worldbank.org/en/topic/debt/brief/covid-19-debt-service-suspension-initiative 

In all, 73 countries are eligible for a temporary suspension of debt-service payments owed to their official bilateral creditors. The G20 has also called on private creditors to participate in the initiative on comparable terms. The suspension period, originally set to end on December 31, 2020, has been extended through June 2021.

Net inflows from
the World Bank (International Bank for
Reconstruction and Development [IBRD]
and International Development Association
[IDA])

"Estimates are derived from monthly IDS projections based on end-2019 external public and publicly guaranteed debt outstanding and disbursed. "

2020 data only available for debt service and principal repayments...


Cleaning the data:
```{r}
dssi <- dssi %>% select(-`Series Code`) %>% gather("Year", "Value", 6:9)

dssi <- dssi %>% anti_join(dssi[c(29785, 29786, 29787, 29788, 29789, 59574, 59575, 59576, 59577, 59578, 89363, 89364, 89365, 89366, 89367, 119152, 119153, 119154, 119155, 119156),])

dssi <- dssi %>% spread(`Series Name`, `Value`)

colnames(dssi) <- c("Debtor", "Debtor_Code", "Creditor", "Creditor_Code", "Year", "Debt_Forgiveness", "Debt_Stocks")

dssi$Debt_Forgiveness <- as.numeric(dssi$Debt_Forgiveness)
dssi$Debt_Stocks <- as.numeric(dssi$Debt_Stocks)
dssi$Year <- as.factor(dssi$Year)

dssi[is.na(dssi)] <- 0

dssi$Debtor <- stringr::str_trim(dssi$Debtor, side = "both")
dssi$Creditor <- stringr::str_trim(dssi$Creditor, side = "both")

dssi <- dssi %>% mutate(Debtor_Region = case_when(
  Debtor %in% c("Angola", "Benin", "Burkina Faso", "Burundi", "Cabo Verde", "Cameroon", "Central African Republic", "Chad", "Comoros", "Congo, Dem. Rep.", "Congo, Rep.", "Cote d'Ivoire", "Djibouti", "Ethiopia", "Gambia, The", "Ghana", "Guinea", "Guinea-Bissau", "Kenya", "Lesotho", "Liberia", "Madagascar", "Malawi", "Mali", "Mauritania", "Mozambique", "Niger", "Nigeria", "Rwanda", "Sao Tome and Principe", "Senegal", "Sierra Leone", "Somalia", "Tanzania", "Togo", "Uganda", "Zambia") ~ "Africa",
  Debtor %in% c("Bangladesh", "Bhutan", "Cambodia", "Kyrgyz Republic", "Lao PDR", "Maldives", "Mongolia", "Myanmar", "Nepal", "Pakistan", "Tajikistan", "Timor-Leste", "Uzbekistan") ~ "Asia",
  Debtor %in% c("Afghanistan", "Yemen, Rep.") ~ "Middle East",
  Debtor %in% c("Guyana", "Haiti", "Honduras", "Nicaragua") ~ "South & Central America",
  Debtor %in% c("Dominica", "Grenada", "St. Lucia", "St. Vincent and the Grenadines") ~ "The Caribbeans",
  Debtor %in% c("Fiji", "Papua New Guinea", "Samoa", "Solomon Islands", "Tonga", "Vanuatu") ~ "Pacific Islands",
  Debtor %in% c("Kosovo", "Moldova") ~ "Europe"
))
```


Debtor countries:
```{r}
dssi$Debtor %>% unique()
```

68 in total.

```{r}

dssi %>% select(Debtor, Debtor_Region) %>% unique() %>% group_by(Debtor_Region) %>% count() %>% arrange(desc(n))
```

Most debtor countries are from Africa, followed by Asia. 


Creditors:
```{r}
dssi$Creditor %>% unique()
```

Includes both countries and multilateral organizations.

## Overall debt levels
```{r}
dssi %>% filter(Creditor == "World") %>% filter(Year %in% c(2000, 2019)) %>% group_by(Year) %>% summarize(global_debt_bil = sum(Debt_Stocks)/10^9)
```

Total global debt increased by more than 180% from US$261 billion in 2000 to US$744 billion in 2019. This is denominated in current US$ (2021) and hence accounts for inflationary effects. 


## Debt levels
```{r}
ggplot(dssi %>% filter(Year != 2020)) + geom_boxplot(aes(as.factor(Year), Debt_Stocks/10^9)) + labs(x = "Year", y = "External debt level (billions)", title = "External debt stocks over time")
```

```{r}
debt_2000 <- dssi %>% filter(Year == 2000)
debt_2019 <- dssi %>% filter(Year == 2019)
```


```{r}
ggplot(debt_2000 %>% filter(Creditor == "World")) + geom_dotplot(aes(Debt_Stocks/10^9), binwidth = 1)

ggplot(debt_2019 %>% filter(Creditor == "World")) + geom_dotplot(aes(Debt_Stocks/10^9), binwidth = 1)
```

```{r}
debt_2000 %>% filter(Creditor == "World")  %>% mutate(Debt_Stocks_Bil = Debt_Stocks/10^9) %>% select(Debtor, Creditor, Debt_Stocks_Bil) %>% arrange(desc(Debt_Stocks_Bil))

debt_2019 %>% filter(Creditor == "World")  %>% mutate(Debt_Stocks_Bil = Debt_Stocks/10^9) %>% select(Debtor, Creditor, Debt_Stocks_Bil) %>% arrange(desc(Debt_Stocks_Bil))
```
2000: Nigeria ($33.5 bil), Pakistan ($33.9 bil), Bangladesh ($15.6 bil), Cote d'Ivoire ($12.1 bil), Angola was ranked 7th at $9.8 bil. 

2019: Pakistan $100 billion followed by Bangladesh ($57 bil), Nigeria ($54 bil), Angola ($51 bil). 

```{r}
debt_2000 %>% group_by(Debtor_Region) %>% filter(Creditor == "World") %>% summarize(total_debt_bil = sum(Debt_Stocks)/10^9, avg_debt_bil = mean(Debt_Stocks)/10^9) %>% arrange(desc(total_debt_bil))

debt_2019 %>% group_by(Debtor_Region) %>% filter(Creditor == "World") %>% summarize(total_debt_bil = sum(Debt_Stocks)/10^9, avg_debt_bil = mean(Debt_Stocks)/10^9) %>% arrange(desc(total_debt_bil))
```


## Creditors

#### 2000:
```{r}
debt_2000 %>% group_by(Creditor) %>% summarize(total_lending_bil = sum(Debt_Stocks)/10^9) %>% arrange(desc(total_lending_bil))
```
Top country creditors: Japan, France, Russian Federation, US, Germany, Italy, UK, China



```{r}
debt_2000 %>% group_by(Creditor) %>% summarize(total_lending_bil = sum(Debt_Stocks)/10^9) %>% ggplot() + geom_dotplot(aes(total_lending_bil))
```


#### 2019: 
```{r}
debt_2019 %>% group_by(Creditor) %>% summarize(total_lending_bil = sum(Debt_Stocks)/10^9) %>% arrange(desc(total_lending_bil))
```

19 years later, China is now the top creditor country. India and Saudi Arabia have also emerged, ranking above the US and Germany. 


Pie Charts~
```{r}
library(highcharter) 
cols <- RColorBrewer::brewer.pal(8, "Dark2")

top_creditors_2000 <- debt_2000 %>% filter(!Creditor %in% c("World", "Multiple Lenders", "Other Multiple Lenders", "Other Multilaterals", "Bondholders", "Other Bilateral")) %>% group_by(Creditor) %>% summarize(total_debt_bil = sum(Debt_Stocks)/10^9) %>% mutate(pct_global_debt = total_debt_bil/261.6634) %>% arrange(desc(total_debt_bil)) %>% head(n = 20)

top_creditors_2019 <- debt_2019 %>% filter(!Creditor %in% c("World", "Multiple Lenders", "Other Multiple Lenders", "Other Multilaterals", "Bondholders", "Other Bilateral")) %>% group_by(Creditor) %>% summarize(total_debt_bil = sum(Debt_Stocks)/10^9) %>% mutate(pct_global_debt = total_debt_bil/744.4824) %>% arrange(desc(total_debt_bil)) %>% head(n = 20) 

top_creditors_2000 %>% hchart("pie", hcaes(x = Creditor, y = total_debt_bil), name = "Total Lending (billions of US$)") %>% hc_title(text = "Top creditors in 2000") %>% hc_subtitle(text = "subtitle") %>% hc_caption(text = "Data: The World Bank (2021)") %>% hc_colors(cols)

top_creditors_2019 %>% hchart("pie", hcaes(x = Creditor, y = total_debt_bil), name = "Total Lending (billions of US$)") %>% hc_title(text = "Top creditors in 2019") %>% hc_subtitle(text = "subtitle") %>% hc_caption(text = "Data: The World Bank (2021)") %>% hc_colors(cols)

## Is there a way to highlight China?
```


```{r}
# or maybe I should choose top creditors based on total across the years
top_creditors <- top_creditors_2000 %>% pull(Creditor) %>% append(top_creditors_2019 %>% pull(Creditor)) %>% unique()

top_creditor_stats <- dssi %>% filter(Creditor %in% top_creditors) %>% filter(Year %in% c(2000, 2019)) %>% group_by(Creditor, Year) %>% summarize(total_lending_bil = sum(Debt_Stocks)/10^9, total_forgiveness_bil = sum(Debt_Forgiveness)/10^9)

top_creditor_stats$pct_global_debt <- ifelse(top_creditor_stats$Year == 2000, top_creditor_stats$total_lending_bil/261.6634, top_creditor_stats$total_lending_bil/744.4824)

ggplot(top_creditor_stats) + geom_col(aes(x = reorder(Creditor, total_lending_bil), y = total_lending_bil, fill = as.factor(Year)), position = "dodge") + coord_flip()

ggplot(top_creditor_stats) + geom_col(aes(x = reorder(Creditor, pct_global_debt), y = pct_global_debt, fill = as.factor(Year)), position = "dodge") + coord_flip() + theme_minimal()
## How do I show 2000 before 2019?
```

As a percentage: China has increased dramatically. International banks including the World Bank, ADB, IMF, African Development Bank have all decreased, as with most other countries. Stark decrease in France, Russia, US, Germany, Japan. 



## Selected Creditors over time (those with drastic changes, top creditors)

Data cleaning:
```{r}
selected_creditors <- read_csv("selected_creditors.csv")

selected_creditors <- selected_creditors %>% select(-`Series Code`)
colnames(selected_creditors) <- c("Debtor", "Debtor_Code", "Creditor", "Creditor_Code", "Series", 2000:2019)

selected_creditors <- selected_creditors %>% gather("year", "value", 6:25)

selected_creditors[which(selected_creditors$Series == "External debt stocks, total (DOD, current US$)"), "Series"] <- "Debt_Stocks"
selected_creditors[which(selected_creditors$Series == "Debt forgiveness or reduction (current US$)"), "Series"] <- "Debt_Forgiveness"

selected_creditors <- selected_creditors %>% filter(!is.na(Series))

selected_creditors <- spread(selected_creditors, Series, value)


selected_creditors$Debt_Forgiveness <- as.numeric(selected_creditors$Debt_Forgiveness)
selected_creditors$Debt_Stocks <- as.numeric(selected_creditors$Debt_Stocks)
selected_creditors$year <- as.numeric(selected_creditors$year)

selected_creditors[is.na(selected_creditors)] <- 0

selected_creditors$Debtor <- stringr::str_trim(selected_creditors$Debtor, side = "both")
selected_creditors$Creditor <- stringr::str_trim(selected_creditors$Creditor, side = "both")

selected_creditors <- selected_creditors %>% mutate(Debtor_Region = case_when(
  Debtor %in% c("Angola", "Benin", "Burkina Faso", "Burundi", "Cabo Verde", "Cameroon", "Central African Republic", "Chad", "Comoros", "Congo, Dem. Rep.", "Congo, Rep.", "Cote d'Ivoire", "Djibouti", "Ethiopia", "Gambia, The", "Ghana", "Guinea", "Guinea-Bissau", "Kenya", "Lesotho", "Liberia", "Madagascar", "Malawi", "Mali", "Mauritania", "Mozambique", "Niger", "Nigeria", "Rwanda", "Sao Tome and Principe", "Senegal", "Sierra Leone", "Somalia", "Tanzania", "Togo", "Uganda", "Zambia") ~ "Africa",
  Debtor %in% c("Bangladesh", "Bhutan", "Cambodia", "Kyrgyz Republic", "Lao PDR", "Maldives", "Mongolia", "Myanmar", "Nepal", "Pakistan", "Tajikistan", "Timor-Leste", "Uzbekistan") ~ "Asia",
  Debtor %in% c("Afghanistan", "Yemen, Rep.") ~ "Middle East",
  Debtor %in% c("Guyana", "Haiti", "Honduras", "Nicaragua") ~ "South & Central America",
  Debtor %in% c("Dominica", "Grenada", "St. Lucia", "St. Vincent and the Grenadines") ~ "The Caribbeans",
  Debtor %in% c("Fiji", "Papua New Guinea", "Samoa", "Solomon Islands", "Tonga", "Vanuatu") ~ "Pacific Islands",
  Debtor %in% c("Kosovo", "Moldova") ~ "Europe"
))
```


```{r}
creditors_years <- selected_creditors %>% group_by(Creditor, year) %>% summarize(total_lending_bil = sum(Debt_Stocks)/10^9)

ggplot(creditors_years) + geom_line(aes(x = year, y = total_lending_bil, color = Creditor)) + theme_minimal()

ggplotly(ggplot(creditors_years) + geom_line(aes(x = year, y = total_lending_bil, color = Creditor)) + theme_minimal()) 
```

```{r}
ggplot(creditors_years %>% filter(Creditor %in% c("China", "Japan", "United States", "United Kingdom", "France", "Saudi Arabia", "India"))) + geom_line(aes(x = year, y = total_lending_bil, color = Creditor)) + theme_minimal()

ggplotly(ggplot(creditors_years %>% filter(Creditor %in% c("China", "Japan", "United States", "United Kingdom", "France", "Saudi Arabia", "India"))) + geom_line(aes(x = year, y = total_lending_bil, color = Creditor)) + theme_minimal())

## Very clear jump from China :0
```


## By region
```{r}
ggplot(selected_creditors %>% filter(Creditor %in% c("China", "Japan", "United States", "United Kingdom", "France", "Saudi Arabia", "India")) %>% filter(Debtor_Region == "Asia")) + geom_smooth(aes(x = year, y = Debt_Stocks, color = Creditor)) + theme_minimal()

ggplot(selected_creditors %>% filter(Creditor %in% c("China", "Japan", "United States", "United Kingdom", "France", "Saudi Arabia", "India")) %>% filter(Debtor_Region == "Africa")) + geom_smooth(aes(x = year, y = Debt_Stocks, color = Creditor)) + theme_minimal()
```



## Next steps: Explore by region, network visualization
